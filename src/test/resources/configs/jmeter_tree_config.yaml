# Enhanced Performance Test Configuration for JMeter TreeBuilder
protocol: http
engine: JMTREE  # Using JMeter TreeBuilder engine
data: sample_HTTP_API_Test.csv

# Global variables available to all scenarios and requests
variables:
  baseUrl: https://jsonplaceholder.typicode.com
  timeout: 30000
  contentType: application/json
  version: 1.0.0

# Execution configuration
execution:
  threads: 5
  iterations: 10
  rampUpSeconds: 2
  holdSeconds: 5
  duration: 60  # Maximum test duration in seconds
  successThreshold: 80.0  # Percentage of successful requests required for test to pass (default: 100%)
  
  # Execution-specific variables
  variables:
    connectionTimeout: 5000
    socketTimeout: 30000
    followRedirects: true

# Test scenarios
scenarios:
  # HTTP API Test Scenario
  - name: JMTree HTTP API Test
    description: Testing HTTP endpoints with JMeter TreeBuilder
    # Scenario-specific variables
    variables:
      apiVersion: v1
      defaultHeaders: src/test/resources/templates/http/headers/default_headers.json
    
    # Requests in this scenario
    requests:
      - name: "Create User"
        protocol: http  # Override global protocol if needed
        endpoint: "https://jsonplaceholder.typicode.com/users"
        method: "POST"
        body: src/test/resources/templates/http/body/create_user_body.json
        headers: src/test/resources/templates/http/headers/create_user_headers.json
        params: src/test/resources/templates/http/params/create_user_params.template
        
        # Request-specific variables
        variables:
          userId: ${iteration}  # Using the current iteration as userId for more realistic testing
          userName: "User ${iteration}"  # Dynamic user name based on iteration
        
        # Response validation schemas
        responses:
          'Passed': src/test/resources/templates/http/schema/create_user.schema.json
          'Failed': src/test/resources/templates/http/schema/genericError.schema.json

      - name: "Get Users"
        endpoint: "https://jsonplaceholder.typicode.com/users"
        method: "GET"
        headers: src/test/resources/templates/http/headers/create_user_headers.json
        params: src/test/resources/templates/http/params/create_user_params.template
        
        # Response validation schemas
        responses:
          'Passed': src/test/resources/templates/http/schema/create_user.schema.json
          'Failed': src/test/resources/templates/http/schema/genericError.schema.json
  
  # HTTPS API Test Scenario
  - name: JMTree HTTPS API Test
    description: Testing secure HTTPS endpoints with JMeter TreeBuilder
    variables:
      userId: 1
    requests:
      - name: "Get User Details"
        protocol: https
        endpoint: "https://jsonplaceholder.typicode.com/users/1"
        method: "GET"
        responses:
          'Passed': src/test/resources/templates/http/schema/create_user.schema.json
          
  # REST API Test Scenario
  - name: REST API Test
    description: Testing RESTful API endpoints using JMeter TreeBuilder
    variables:
      userId: 2
      postId: 1
    requests:
      - name: "Get User"
        endpoint: "https://jsonplaceholder.typicode.com/users/${userId}"
        method: "GET"
        headers:
          Accept: "application/json"
          User-Agent: "JMeter-TreeBuilder-Test"
        
      - name: "Get User Posts"
        endpoint: "https://jsonplaceholder.typicode.com/users/${userId}/posts"
        method: "GET"
        headers:
          Accept: "application/json"
          
      - name: "Get Post Comments"
        endpoint: "https://jsonplaceholder.typicode.com/posts/${postId}/comments"
        method: "GET"
        headers:
          Accept: "application/json"